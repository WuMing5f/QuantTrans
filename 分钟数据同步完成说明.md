# 分钟数据同步完成说明

## 当前数据状态

### ✅ 近一周数据（已成功同步）

已成功同步**8个ETF**的近一周1分钟K线数据：

| ETF代码 | ETF名称 | 数据条数 | 时间范围 |
|---------|---------|---------|----------|
| 159901 | 深证100ETF | 1,205条 | 2025-12-15 至 2025-12-19 |
| 159919 | 沪深300ETF（深市） | 1,205条 | 2025-12-15 至 2025-12-19 |
| 510050 | 50ETF | 1,205条 | 2025-12-15 至 2025-12-19 |
| 510300 | 沪深300ETF | 1,205条 | 2025-12-15 至 2025-12-19 |
| 510500 | 中证500ETF | 1,205条 | 2025-12-15 至 2025-12-19 |
| 512000 | 券商ETF | 1,205条 | 2025-12-15 至 2025-12-19 |
| 512100 | 1000ETF | 1,205条 | 2025-12-15 至 2025-12-19 |
| 515050 | 5G ETF | 1,205条 | 2025-12-15 至 2025-12-19 |

**总计：约9,640条1分钟K线数据**

**说明**：
- 每个ETF约1,205条数据
- 覆盖约5个交易日（12月15日-19日）
- 每个交易日约240个1分钟K线（09:30-15:00，共5.5小时）

### ⚠️ 历史数据获取情况

**问题**：尝试获取2024年1月1日至今的历史数据时，akshare的分钟数据接口返回空数据。

**可能原因**：
1. akshare的分钟数据接口可能只支持获取最近一段时间的数据（如最近30-60天）
2. 历史数据可能需要付费或使用其他数据源
3. 接口对历史数据有访问限制

## 已实现的功能

### 1. 数据库模型

创建了 `CandleMinute` 模型，用于存储分钟K线数据：
- 支持不同时间间隔（1m, 5m, 15m, 30m, 60m）
- 使用datetime字段存储完整的时间信息
- 包含完整的OHLCV数据

### 2. 数据获取接口

在 `AkShareCNProvider` 中添加了 `fetch_history_minute` 方法：
- 支持1、5、15、30、60分钟数据
- 自动处理时区转换（北京时间UTC+8）
- 支持按天分段获取大量数据

### 3. 数据同步命令

创建了两个管理命令：

**单个ETF同步**：
```bash
python manage.py sync_minute_data --symbol 510300 --market CN --interval 1m --days 7
```

**批量同步**：
```bash
python manage.py batch_sync_minute --interval 1m --days 7
```

## 历史数据获取建议

### 方案1：逐步向后获取（推荐）

由于akshare可能只支持最近一段时间的数据，可以尝试：
1. 从最近的数据开始，逐步向后获取
2. 每次获取30-60天的数据
3. 逐步补充历史数据

```bash
# 尝试获取最近30天的数据
python manage.py batch_sync_minute --interval 1m --days 30 --delay 3

# 尝试获取最近60天的数据
python manage.py batch_sync_minute --interval 1m --days 60 --delay 3
```

### 方案2：使用5分钟数据替代1分钟数据

5分钟数据的量更少（每天约48个K线），可能支持更长的历史数据：

```bash
python manage.py batch_sync_minute --interval 5m --start 2024-01-01 --delay 3
```

### 方案3：考虑其他数据源

如果akshare不支持完整历史数据，可以考虑：
1. 券商API（部分券商提供历史分钟数据）
2. 专业数据服务商（如Wind、Choice等，可能需要付费）
3. 日线数据聚合（从日线数据无法还原分钟数据，只能用于分析）

## 数据查看

### Django Admin

访问 http://127.0.0.1:8000/admin/ 可以查看和管理分钟数据。

### 命令行查看

```python
python manage.py shell
```

```python
from apps.data_master.models import Instrument, CandleMinute

# 查看某个ETF的分钟数据
etf = Instrument.objects.get(symbol='510300')
minutes = CandleMinute.objects.filter(instrument=etf, interval='1m').order_by('datetime')
print(f'数据条数: {minutes.count()}')
print(f'时间范围: {minutes.first().datetime} 到 {minutes.last().datetime}')

# 查看某一天的数据
from datetime import date
day_minutes = minutes.filter(datetime__date=date(2025, 12, 19))
print(f'12月19日数据: {day_minutes.count()} 条')
```

## 下一步建议

1. **保持近一周数据更新**：
   - 每天收盘后自动更新当天的分钟数据
   - 使用定时任务定期同步

2. **尝试获取更多历史数据**：
   - 尝试获取最近30-60天的数据
   - 如果成功，可以逐步向后获取

3. **考虑数据保留策略**：
   - 1分钟数据量很大，建议只保留最近30-90天
   - 更长时间的历史可以使用5分钟或15分钟数据

4. **可视化支持**（未来）：
   - 可以在图表页面添加分钟K线图选项
   - 支持切换日线和分钟K线视图

## 注意事项

1. **数据量**：
   - 1分钟数据量很大（每天约240条）
   - 9个ETF × 30天 ≈ 64,800条数据
   - 建议合理规划存储空间

2. **时区处理**：
   - 数据已自动转换为带时区的datetime（UTC+8）
   - Django的USE_TZ=True已启用

3. **数据完整性**：
   - 系统会自动去重，不会创建重复记录
   - 可以安全地多次同步同一时间范围的数据

