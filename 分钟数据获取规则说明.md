# 分钟数据获取规则说明

## akshare分钟数据接口的获取规则

### 📊 测试结果总结

经过实际测试，akshare的 `fund_etf_hist_min_em` 接口有以下规则：

### 1. 默认行为（不指定日期范围）

**规则**：返回**最近约5个交易日**的数据

**示例**：
- 测试时间：2025-12-20
- 默认返回：2025-12-15 至 2025-12-19 的数据（约1205条1分钟数据）
- 时间跨度：约5个交易日

### 2. 指定日期范围的限制

**规则**：只能获取**最近约5-7天**的数据

**测试结果**：
- ✅ **5天前**：可以获取数据
- ✅ **7天前**：可能可以获取数据（取决于是否为交易日）
- ❌ **10天前**：无法获取数据
- ❌ **更久远**：无法获取数据

### 3. 数据可用性

| 时间范围 | 是否可用 | 说明 |
|---------|---------|------|
| 当天 | ✅ | 可以获取（如果已收盘） |
| 1-5天前 | ✅ | 可以获取 |
| 6-7天前 | ⚠️ | 可能可以获取（取决于交易日） |
| 8天及更久 | ❌ | 无法获取 |

### 4. 实际获取示例

```python
import akshare as ak
from datetime import datetime, timedelta

symbol = '510300'

# 方式1：不指定日期（推荐）
# 返回最近约5天的数据
df = ak.fund_etf_hist_min_em(symbol=symbol, period='1', adjust='qfq')
# 结果：约1205条数据，时间跨度约5天

# 方式2：指定最近3天的日期范围
end_date = datetime.now()
start_date = end_date - timedelta(days=3)
df = ak.fund_etf_hist_min_em(
    symbol=symbol,
    start_date=start_date.strftime('%Y-%m-%d %H:%M:%S'),
    end_date=end_date.strftime('%Y-%m-%d %H:%M:%S'),
    period='1',
    adjust='qfq'
)
# 结果：可能获取到约482条数据（取决于交易日数量）

# 方式3：尝试获取10天前的数据（会失败）
end_date = datetime.now() - timedelta(days=10)
start_date = end_date - timedelta(days=1)
df = ak.fund_etf_hist_min_em(
    symbol=symbol,
    start_date=start_date.strftime('%Y-%m-%d %H:%M:%S'),
    end_date=end_date.strftime('%Y-%m-%d %H:%M:%S'),
    period='1',
    adjust='qfq'
)
# 结果：返回空DataFrame（0条数据）
```

## 总结

### ✅ 可以获取的数据

1. **最近5个交易日**的分钟数据
2. **默认行为**：不指定日期时，自动返回最近约5天的数据
3. **指定日期**：可以获取最近5-7天的数据（如果日期范围内有交易日）

### ❌ 无法获取的数据

1. **更久远的历史数据**（8天及更久）
2. **非交易日的数据**（周末、节假日）
3. **未来日期**的数据

### 💡 建议

1. **日常使用**：
   - 建议每天收盘后同步当天的分钟数据
   - 可以逐步积累历史数据（虽然无法一次性获取很久的数据）

2. **数据保留策略**：
   - 分钟数据量很大，建议只保留最近30-60天的数据
   - 更长时间的历史可以使用日K数据

3. **如果需要更久的历史分钟数据**：
   - 考虑使用其他数据源（券商API、付费数据服务）
   - 或者使用5分钟、15分钟等更长周期的数据

## 与当前系统的关系

### 当前实现

系统已实现：
- ✅ 每天同步最近的分钟数据（`batch_sync_minute`）
- ✅ 限制显示数据量（避免图表过于密集）
- ✅ 时间转换（UTC → 北京时间）

### 数据积累策略

由于akshare只能获取最近约5天的数据，建议：

1. **每日同步**：
   ```bash
   # 每天收盘后运行，同步当天的分钟数据
   python manage.py batch_sync_minute --interval 1m --days 1
   ```

2. **逐步积累**：
   - 每天同步，可以逐步积累历史数据
   - 虽然无法一次性获取很久的数据，但可以通过每日同步保持数据更新

3. **数据量控制**：
   - 1分钟数据：建议只保留最近30天
   - 5分钟数据：建议保留最近90天
   - 15分钟数据：建议保留最近180天

