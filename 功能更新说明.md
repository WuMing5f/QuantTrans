# 功能更新说明

## ✅ 已完成的更新

### 1. 成交量买卖图示改进

**改进内容**：
- 成交量图表现在分为两个系列：`成交量(涨)` 和 `成交量(跌)`
- 绿色柱状图表示上涨时的成交量
- 红色柱状图表示下跌时的成交量
- 图例中明确标注了涨跌，更容易理解

**效果**：
- 可以更直观地看到买卖力量的对比
- 上涨时的成交量用绿色表示，下跌时的成交量用红色表示
- 通过堆叠显示，可以清楚地看到整体的成交量分布

### 2. 从1分钟K线聚合生成5分钟和1小时K线

**实现功能**：
- 创建了 `aggregate_minute_data` 管理命令
- 可以从1分钟K线数据自动计算5分钟和1小时K线
- 聚合规则：
  - **开盘价**：使用该时间段第一个1分钟K线的开盘价
  - **收盘价**：使用该时间段最后一个1分钟K线的收盘价
  - **最高价**：使用该时间段所有1分钟K线的最高价
  - **最低价**：使用该时间段所有1分钟K线的最低价
  - **成交量**：累加该时间段所有1分钟K线的成交量
  - **成交额**：累加该时间段所有1分钟K线的成交额

**使用方法**：
```bash
# 生成5分钟K线
python manage.py aggregate_minute_data --interval 5m

# 生成1小时K线
python manage.py aggregate_minute_data --interval 60m

# 生成所有间隔（5分钟和1小时）
python manage.py aggregate_minute_data --interval all

# 只处理特定标的
python manage.py aggregate_minute_data --interval all --symbol 159901
```

**数据验证**：
- 5分钟数据量约为1分钟数据的20%（5个1分钟K线 = 1个5分钟K线）
- 1小时数据量约为1分钟数据的约1.7%（60个1分钟K线 = 1个1小时K线）

### 3. 补充更多行业ETF

**新增ETF列表**：

#### 宽基指数（已有）
- 510300, 510500, 159919, 159915, 512100, 159901, 510050

#### 行业ETF - 金融
- **512000** - 券商ETF
- **512170** - 银行ETF
- **512800** - 银行ETF（华安）

#### 行业ETF - 科技
- **515050** - 5G ETF
- **512760** - 芯片ETF
- **159997** - 芯片ETF（广发）
- **515880** - 通信ETF
- **515030** - 新基建ETF

#### 行业ETF - 消费
- **159928** - 消费ETF
- **512600** - 消费ETF（南方）
- **516160** - 新能源ETF
- **159824** - 新能源ETF（博时）

#### 行业ETF - 医疗
- **159929** - 医药ETF

#### 行业ETF - 其他
- **512980** - 传媒ETF
- **516950** - 军工ETF

**更新位置**：
- `apps/data_master/management/commands/batch_sync.py` - 日K数据同步
- `apps/data_master/management/commands/batch_sync_minute.py` - 分钟K数据同步

## 📊 数据准备流程

### 完整的分钟数据准备流程

1. **同步1分钟数据**：
   ```bash
   python manage.py batch_sync_minute --interval 1m --days 7
   ```

2. **从1分钟数据聚合生成5分钟和1小时数据**：
   ```bash
   python manage.py aggregate_minute_data --interval all
   ```

3. **查看图表**：
   - 访问 http://127.0.0.1:8000/chart/159901/
   - 可以选择不同的时间粒度：日K、1分钟、5分钟、1小时

## 🔄 数据同步建议

### 每日数据更新流程

1. **同步当日1分钟数据**：
   ```bash
   python manage.py batch_sync_minute --interval 1m --days 1
   ```

2. **聚合生成5分钟和1小时数据**：
   ```bash
   python manage.py aggregate_minute_data --interval all
   ```

3. **同步日K数据**（如果需要）：
   ```bash
   python manage.py batch_sync --type etf --days 1
   ```

## 🎯 下一步：回测功能

现在数据已经准备就绪，可以开始实现回测功能了。系统已经具备：

1. ✅ 日K数据（用于长期回测）
2. ✅ 1分钟K数据（用于短期/日内回测）
3. ✅ 5分钟K数据（用于中短期回测）
4. ✅ 1小时K数据（用于中期回测）
5. ✅ 技术指标计算（MA、MACD、RSI、布林带等）

可以开始实现：
- 回测引擎配置
- 策略编写
- 回测结果展示
- 性能指标分析

