# 数据可视化功能说明

## 功能概述

系统提供了完整的数据可视化功能，可以展示：
- **K线图**：蜡烛图展示价格走势
- **移动平均线**：MA5、MA20、MA60
- **布林带**：上轨、中轨、下轨
- **MACD指标**：MACD线、信号线、柱状图
- **RSI指标**：相对强弱指标
- **成交量**：柱状图展示交易量

## 时间粒度切换功能 ⭐ 新功能

### 功能说明

图表页面现在支持切换不同的时间粒度显示：

- **日K**：显示日线K线数据（从 `Candle` 模型获取）
- **1分钟**：显示1分钟K线数据（从 `CandleMinute` 模型获取）
- **5分钟**：显示5分钟K线数据
- **15分钟**：显示15分钟K线数据
- **30分钟**：显示30分钟K线数据
- **60分钟**：显示60分钟K线数据

### 使用方法

1. 访问任意ETF或股票的图表页面（例如：http://127.0.0.1:8000/chart/510300/）
2. 在页面顶部找到"时间粒度"选择器
3. 点击不同的按钮切换时间粒度
4. 图表会自动重新加载对应时间粒度的数据并更新所有图表

### 数据说明

- **日K数据**：从 `Candle` 模型获取，包含所有历史日线数据
- **分钟K数据**：从 `CandleMinute` 模型获取，目前主要包含最近一周的1分钟数据
- 如果某个时间粒度没有数据，会显示错误提示

### 注意事项

- 分钟数据的时间格式会显示为 `YYYY-MM-DD HH:MM`（包含时间）
- 日K数据的时间格式为 `YYYY-MM-DD`（仅日期）
- 切换时间粒度时，所有图表（K线图、MACD、RSI）都会同步更新

## 使用方法

### 1. 启动服务器

```bash
cd /Users/zhiyiwu/Desktop/Coding/AICoding/AIProject/StockTrans
source venv/bin/activate
python manage.py runserver
```

### 2. 访问首页

打开浏览器访问：http://127.0.0.1:8000/

你会看到已同步的标的列表，每个标的都有一个"查看图表"按钮。

### 3. 查看图表

点击任意标的的"查看图表"按钮，即可查看该标的的K线图和技术指标。

图表页面URL格式：http://127.0.0.1:8000/chart/<标的代码>/

例如：
- http://127.0.0.1:8000/chart/510300/
- http://127.0.0.1:8000/chart/AAPL/

## 图表功能说明

### K线图区域

1. **K线蜡烛图**：
   - 绿色（上涨）：收盘价 > 开盘价
   - 红色（下跌）：收盘价 < 开盘价

2. **移动平均线**：
   - 橙色线：MA5（5日均线）
   - 蓝色线：MA20（20日均线）
   - 粉色线：MA60（60日均线）

3. **布林带**：
   - 灰色虚线：上轨和下轨
   - 灰色实线：中轨（20日均线）

4. **成交量**：
   - 柱状图展示每日成交量
   - 颜色与K线涨跌对应

### MACD指标图

- **MACD线**（金色）：快慢均线的差值
- **Signal线**（粉色）：MACD的移动平均
- **Histogram柱状图**：MACD与Signal的差值
  - 绿色：正值（看涨信号）
  - 红色：负值（看跌信号）

### RSI指标图

- **RSI线**（紫色）：相对强弱指标，范围0-100
- **参考线**：
  - 70以上：超买区域（红色虚线）
  - 30以下：超卖区域（绿色虚线）

## 交互功能

1. **缩放**：
   - 鼠标滚轮：放大缩小
   - 拖拽滑块：移动时间范围

2. **数据提示**：
   - 鼠标悬停在图表上：显示具体数值
   - 点击图例：显示/隐藏对应的指标

3. **自适应**：
   - 图表会根据窗口大小自动调整
   - 支持响应式设计

## 技术实现

### 前端技术
- **ECharts 5.4.3**：专业的数据可视化图表库
- **暗色主题**：适合长时间查看
- **异步加载**：数据通过API异步获取，提升用户体验

### 后端API

数据API接口：`/api/data/<标的代码>/?interval=<时间粒度>`

**参数说明**：
- `interval`：时间粒度（可选）
  - `daily`：日K（默认）
  - `1m`：1分钟K
  - `5m`：5分钟K
  - `15m`：15分钟K
  - `30m`：30分钟K
  - `60m`：60分钟K

**示例**：
- `/api/data/510300/` - 获取日K数据
- `/api/data/510300/?interval=1m` - 获取1分钟K数据
- `/api/data/510300/?interval=5m` - 获取5分钟K数据

返回JSON格式数据，包含：
- `dates`: 日期数组
- `kline`: K线数据（开盘、收盘、最低、最高）
- `volume`: 成交量数据
- `ma5`, `ma20`, `ma60`: 移动平均线数据
- `macd`, `macd_signal`, `macd_hist`: MACD指标数据
- `rsi`: RSI指标数据
- `bbu`, `bbm`, `bbl`: 布林带数据

## 注意事项

1. **数据要求**：
   - 需要先同步数据才能查看图表
   - 数据越多，技术指标计算越准确
   - 建议至少有60条数据以显示完整的MA60和布林带

2. **性能优化**：
   - 大量数据（如超过1000条）可能加载较慢
   - 图表会自动进行数据缩放以提高性能

3. **浏览器兼容**：
   - 推荐使用Chrome、Firefox、Safari等现代浏览器
   - 需要支持JavaScript和Canvas

## 示例

### 查看沪深300ETF的图表

1. 确保已同步数据：
```bash
python manage.py sync_data --symbol 510300 --market CN --start 2023-12-01 --end 2023-12-31 --name "沪深300ETF"
```

2. 启动服务器并访问：
   - 首页：http://127.0.0.1:8000/
   - 点击"查看图表"按钮
   - 或直接访问：http://127.0.0.1:8000/chart/510300/

## 未来扩展

可以扩展的功能：
- 更多技术指标（KDJ、OBV等）
- 自定义时间范围选择
- 图表导出功能（PNG、PDF）
- 数据对比功能（多标的对比）
- 实时数据更新

