# 新策略说明文档

本文档说明新增的4个交易策略及其使用方法。

## 新增策略列表

### 1. VCP波动收缩策略 (vcp)

**策略原理：**
- VCP (Volatility Contraction Pattern) 是由Mark Minervini提出的经典形态
- 识别价格波动逐渐收缩、成交量减少的整理形态
- 在突破时买入，属于右侧交易策略

**核心逻辑：**
- 使用ATR（平均真实波幅）衡量波动率
- 当前波动率 < 历史波动率的70%时，认为发生波动收缩
- 当前成交量 < 历史平均成交量的80%时，认为成交量收缩
- 价格突破近期高点2%以上时，触发买入信号
- 止损：价格跌破买入价的8%或跌破近期低点

**适用场景：**
- 适合震荡后的突破行情
- 适合波动率较高的股票/ETF
- 需要足够的成交量数据支持

**参数说明：**
- `lookback` (20): 回看周期，用于计算波动率和成交量基准
- `contraction_ratio` (0.7): 波动收缩比例阈值，越小要求越严格
- `volume_ratio` (0.8): 成交量收缩比例，越小要求越严格
- `breakout_threshold` (1.02): 突破阈值，1.02表示突破2%

---

### 2. 蜡烛图形态策略 (candlestick)

**策略原理：**
- 识别经典的蜡烛图形态进行交易
- 包括：锤子线、吞没形态、十字星等
- 结合确认机制过滤虚假信号

**识别的形态：**
- **看涨锤子线（Bullish Hammer）**：下影线是实体的2倍以上，出现在下跌后，预示反转
- **看跌锤子线（Bearish Hammer）**：出现在上涨后，预示反转
- **看涨吞没（Bullish Engulfing）**：后一根阳线完全包裹前一根阴线
- **看跌吞没（Bearish Engulfing）**：后一根阴线完全包裹前一根阳线
- **十字星（Doji）**：实体很小，表示市场犹豫，可能预示反转

**核心逻辑：**
- 检测到看涨形态后，等待价格确认（2个交易日后价格高于形态出现时的价格）再买入
- 检测到看跌形态或止损（亏损5%）时卖出

**适用场景：**
- 适合短期交易
- 适合波动较大的市场
- 需要结合其他指标确认

**参数说明：**
- `pattern_type` ('all'): 要识别的形态类型，可选'all'、'hammer'、'engulfing'、'doji'
- `confirmation_period` (2): 确认周期，形态出现后等待的天数
- `min_body_ratio` (0.3): 最小实体比例，用于识别锤子线
- `min_shadow_ratio` (2.0): 最小影线比例，影线至少是实体的2倍

---

### 3. 波段交易策略 (swing)

**策略原理：**
- 在上升趋势中，等待价格回调至支撑位买入
- 在阻力位或达到盈利目标时卖出
- 适合中短期交易（几天到几周）

**核心逻辑：**
- 使用双均线（10日、20日）判断趋势：快线上穿慢线为上升趋势
- 在上升趋势中，价格回调至波段低点或回调5%时买入
- 卖出条件：
  - 达到盈利目标（10%）
  - 触发止损（亏损5%）
  - 趋势反转（快线下穿慢线）
  - 达到波段高点

**适用场景：**
- 适合有明显趋势的股票/ETF
- 适合中短期交易（1-4周）
- 不适合震荡市

**参数说明：**
- `trend_period` (20): 趋势判断周期，用于计算慢线
- `swing_period` (10): 波段周期，用于计算波段高点和低点
- `pullback_ratio` (0.05): 回调比例，价格回调5%时买入
- `profit_target` (0.10): 盈利目标，盈利10%时卖出
- `stop_loss` (0.05): 止损比例，亏损5%时止损

---

### 4. 趋势跟踪策略 (trend_following)

**策略原理：**
- 等待趋势确认后入场，属于右侧交易
- 使用ADX指标确认趋势强度
- 使用追踪止损锁定利润

**核心逻辑：**
- 使用双均线判断趋势方向：快线（10日）> 慢线（30日）为上升趋势
- 使用ADX指标确认趋势强度：ADX > 25时认为趋势强劲
- 买入条件：趋势向上 + ADX > 25 + 价格站上快线
- 卖出条件：
  - 趋势反转（快线下穿慢线）
  - 追踪止损：从最高点回撤3%
  - 趋势减弱：ADX下降到20以下

**适用场景：**
- 适合有明显趋势的市场
- 适合中长线交易
- 不适合震荡市

**参数说明：**
- `fast_period` (10): 快线周期
- `slow_period` (30): 慢线周期
- `adx_period` (14): ADX指标计算周期
- `adx_threshold` (25): ADX阈值，超过此值认为趋势强劲
- `trailing_stop` (0.03): 追踪止损比例，从最高点回撤3%时卖出

---

## 策略对比

| 策略 | 交易风格 | 持仓周期 | 适用市场 | 风险等级 |
|------|---------|---------|---------|---------|
| VCP | 右侧交易 | 中短期 | 突破行情 | 中等 |
| 蜡烛图 | 反转交易 | 短期 | 震荡市/反转 | 较高 |
| 波段交易 | 趋势+回调 | 中短期 | 上升趋势 | 中等 |
| 趋势跟踪 | 右侧交易 | 中长期 | 明显趋势 | 较低 |

## 使用建议

1. **选择合适的策略**：
   - 有明显趋势时：使用趋势跟踪或波段交易
   - 震荡整理后突破：使用VCP策略
   - 短期波动较大：使用蜡烛图策略

2. **参数优化**：
   - 根据回测结果调整参数
   - 不同市场（A股/美股）可能需要不同参数
   - 不同标的（ETF/股票）可能需要微调

3. **风险管理**：
   - 所有策略都设置了止损机制
   - 建议根据标的的波动率调整止损比例
   - 避免在震荡市中过度交易

4. **组合使用**：
   - 可以同时使用多个策略
   - 不同策略的信号可以相互验证
   - 但要注意避免过度优化

## 注意事项

1. **数据要求**：所有策略都需要足够的历史数据，建议至少50个交易日的数据
2. **市场环境**：策略在不同市场环境下表现可能差异很大
3. **参数敏感性**：部分策略对参数较为敏感，建议通过回测优化
4. **实盘验证**：回测结果仅供参考，实盘交易前需要充分验证

## 更新日志

- 2025-12-21: 新增4个策略（VCP、蜡烛图、波段交易、趋势跟踪）
- 所有策略都已集成交易时点记录功能，可以在图表上显示买入/卖出标记

